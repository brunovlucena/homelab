---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: external-secrets
  namespace: external-secrets
spec:
  chart:
    spec:
      chart: external-secrets
      sourceRef:
        kind: HelmRepository
        name: external-secrets
        namespace: flux-system
      version: "0.11.0"
  interval: 1h0m0s
  releaseName: external-secrets
  targetNamespace: external-secrets
  install:
    crds: Create
  upgrade:
    crds: CreateReplace
  values:
    # Use local registry (override default: oci.external-secrets.io/external-secrets/external-secrets)
    image:
      repository: localhost:5001/external-secrets
      tag: "v0.11.0"
      pullPolicy: IfNotPresent
    
    # Apply to webhook and cert-controller too
    webhook:
      image:
        repository: localhost:5001/external-secrets
        tag: "v0.11.0"
    
    certController:
      image:
        repository: localhost:5001/external-secrets
        tag: "v0.11.0"
    
    # Pod Security Standards compliance
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      runAsNonRoot: true
      runAsUser: 65534
      seccompProfile:
        type: RuntimeDefault
      capabilities:
        drop:
          - ALL

