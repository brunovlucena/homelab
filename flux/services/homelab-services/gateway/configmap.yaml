apiVersion: v1
kind: ConfigMap
metadata:
  name: kong-config
  namespace: homelab-services
data:
  kong.yml: |
    _format_version: "3.0"
    
    services:
      # DJ Collab P2P
      - name: dj-collab-p2p
        url: http://dj-collab-p2p-server.dj-collab-p2p.svc.cluster.local:8080
        routes:
          - name: dj-collab-route
            paths:
              - /api/v1/dj-collab
            strip_path: true
        plugins:
          - name: jwt
          - name: cors
          - name: rate-limiting
            config:
              minute: 100
      
      # Spotify P2P
      - name: spotify-p2p
        url: http://spotify-p2p-server.spotify-p2p.svc.cluster.local:8080
        routes:
          - name: spotify-p2p-route
            paths:
              - /api/v1/spotify-p2p
            strip_path: true
        plugins:
          - name: jwt
          - name: cors
          - name: rate-limiting
            config:
              minute: 100
      
      # rekordbox Cloud
      - name: rekordbox-cloud
        url: http://rekordbox-cloud-server.rekordbox-cloud.svc.cluster.local:8080
        routes:
          - name: rekordbox-route
            paths:
              - /api/v1/rekordbox
            strip_path: true
        plugins:
          - name: jwt
          - name: cors
          - name: rate-limiting
            config:
              minute: 100
      
      # Mobile API (for AgentApp)
      - name: mobile-api
        url: http://mobile-api.homelab-services.svc.cluster.local:8080
        routes:
          - name: mobile-api-route
            paths:
              - /api/v1/cloudevents
              - /api/v1/services
              - /api/v1/agents
            strip_path: false
        plugins:
          - name: cors
          - name: rate-limiting
            config:
              minute: 200
      
      # Library Manager
      - name: library-manager
        url: http://library-manager.library-manager.svc.cluster.local:8080
        routes:
          - name: library-route
            paths:
              - /api/v1/library
            strip_path: true
        plugins:
          - name: jwt
          - name: cors
      
      # Auth Service
      - name: auth-service
        url: http://auth-service.homelab-services.svc.cluster.local:8080
        routes:
          - name: auth-route
            paths:
              - /api/v1/auth
            strip_path: true
        plugins:
          - name: cors
      
      # Services Discovery
      - name: services-discovery
        url: http://services-discovery.homelab-services.svc.cluster.local:8080
        routes:
          - name: services-route
            paths:
              - /api/v1/services
            strip_path: true
        plugins:
          - name: jwt
          - name: cors
