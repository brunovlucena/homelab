# Homepage Architecture - Quick Visual Reference

## ğŸ­ Production Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ HTTPS
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cloudflare  â”‚ (CDN, SSL)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Kubernetes Cluster (homepage namespace)        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Frontend Pod        â”‚         â”‚    API Pod           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚   nginx        â”‚  â”‚ /api/*  â”‚  â”‚  Go API Server â”‚ â”‚ â”‚
â”‚  â”‚  â”‚   :8080        â”‚â—„â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–ºâ”‚  :8080         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                â”‚  â”‚         â”‚  â”‚  (Gin)         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Serves:       â”‚  â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚  â”‚  - Static filesâ”‚  â”‚         â”‚           â”‚         â”‚ â”‚
â”‚  â”‚  â”‚  - index.html  â”‚  â”‚         â”‚           â”‚         â”‚ â”‚
â”‚  â”‚  â”‚  - Proxies API â”‚  â”‚         â”‚           â”‚         â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚           â”‚         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚           â”‚         â”‚ â”‚
â”‚                                    â”‚           â”‚         â”‚ â”‚
â”‚                                    â”‚           â–¼         â”‚ â”‚
â”‚                                    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚                                    â”‚    â”‚PostgreSQLâ”‚    â”‚ â”‚
â”‚                                    â”‚    â”‚(postgres) â”‚    â”‚ â”‚
â”‚                                    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚                                    â”‚           â”‚         â”‚ â”‚
â”‚                                    â”‚           â–¼         â”‚ â”‚
â”‚                                    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚                                    â”‚    â”‚  Redis   â”‚    â”‚ â”‚
â”‚                                    â”‚    â”‚(redis)    â”‚    â”‚ â”‚
â”‚                                    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’» Local Development Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Developer Machine                               â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Vite Dev Server     â”‚         â”‚   Go API Server      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  npm run dev  â”‚  â”‚ /api/*  â”‚  â”‚  go run main.goâ”‚  â”‚ â”‚
â”‚  â”‚  â”‚  :5173        â”‚â—„â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–ºâ”‚  :8080         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚               â”‚  â”‚         â”‚  â”‚                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - HMR        â”‚  â”‚         â”‚  â”‚  - Connects to â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Hot reload â”‚  â”‚         â”‚  â”‚    localhost:   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Proxy API  â”‚  â”‚         â”‚  â”‚    5432 (DB)    â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  Command: make dev                                          â”‚
â”‚  - Starts both in parallel                                  â”‚
â”‚  - No Docker, no Kubernetes                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”€ Telepresence Development Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Developer Machine                                 â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚  â”‚  Local Containers      â”‚                                         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                         â”‚
â”‚  â”‚  â”‚  API Container   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  â”‚  (Docker)        â”‚  â”‚  â”‚ Frontend Containerâ”‚                 â”‚
â”‚  â”‚  â”‚  :8080           â”‚  â”‚  â”‚ (Docker)         â”‚                 â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚ :8080            â”‚                 â”‚
â”‚  â”‚  â”‚  - Local code    â”‚  â”‚  â”‚                  â”‚                 â”‚
â”‚  â”‚  â”‚  - DB: localhost  â”‚  â”‚  â”‚  - Volume mount  â”‚                 â”‚
â”‚  â”‚  â”‚     :5432 (pf)    â”‚  â”‚  â”‚  - Vite dev      â”‚                 â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  - Hot reload    â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚         â”‚                    â”‚         â”‚                              â”‚
â”‚         â”‚ Telepresence      â”‚         â”‚ Telepresence                 â”‚
â”‚         â”‚ Intercept         â”‚         â”‚ Intercept                     â”‚
â”‚         â–¼                    â”‚         â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Telepresence VPN Tunnel                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Kubernetes Cluster                                      â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Frontend Service    â”‚         â”‚    API Service       â”‚        â”‚
â”‚  â”‚  (intercepted)       â”‚         â”‚  (intercepted)       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                      â”‚
â”‚  Traffic Flow:                                                      â”‚
â”‚  User â†’ Cloudflare â†’ K8s Service â†’ Telepresence â†’ Local Container  â”‚
â”‚                                                                      â”‚
â”‚  Commands:                                                          â”‚
â”‚  - make tp-port-forward  (setup)                                    â”‚
â”‚  - make tp-api          (intercept API)                             â”‚
â”‚  - make tp-frontend     (intercept Frontend)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Build Process

### Frontend Build

```
React/TypeScript Source
        â”‚
        â–¼
   npm run build
   (vite build)
        â”‚
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  /dist/     â”‚  â† Static files
   â”‚  - index.html
   â”‚  - assets/*.js
   â”‚  - assets/*.css
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   Docker Build
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Stage 1:   â”‚  â† node:22-alpine
   â”‚  Build      â”‚     npm ci
   â”‚             â”‚     vite build
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Stage 2:   â”‚  â† nginx:alpine
   â”‚  Production â”‚     Copy /dist
   â”‚             â”‚     Copy nginx.conf
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   Image: homepage-frontend:v0.1.20
          â”‚
          â–¼
   Push to: localhost:5001
          â”‚
          â–¼
   K8s Deployment pulls & runs
```

### API Build

```
Go Source Code
        â”‚
        â–¼
   Docker Build
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Stage 1:   â”‚  â† golang:1.25-alpine
   â”‚  Build      â”‚     go mod download
   â”‚             â”‚     go build
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Stage 2:   â”‚  â† scratch (minimal)
   â”‚  Production â”‚     Copy binary
   â”‚             â”‚     Copy CA certs
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   Image: homepage-api:v0.1.19
          â”‚
          â–¼
   Push to: localhost:5001
          â”‚
          â–¼
   K8s Deployment pulls & runs
```

---

## ğŸ”„ Request Flow Examples

### Example 1: User visits homepage

```
User â†’ Cloudflare â†’ Frontend Pod (nginx)
                          â”‚
                          â”œâ”€â–º Serves index.html
                          â”‚
                          â””â”€â–º Browser loads React app
                              â””â”€â–º React Router renders Home component
                                  â””â”€â–º Component calls apiClient.getProjects()
                                      â””â”€â–º Request: GET /api/projects
                                          â””â”€â–º nginx proxies to API
                                              â””â”€â–º API queries PostgreSQL
                                                  â””â”€â–º Returns JSON
                                                      â””â”€â–º React updates UI
```

### Example 2: User uses chatbot

```
User types message
    â”‚
    â–¼
React Chatbot Component
    â”‚
    â–¼
apiClient.post('/api/chat', { message })
    â”‚
    â–¼
nginx proxies to API
    â”‚
    â–¼
API: POST /api/chat
    â”‚
    â”œâ”€â–º Queries PostgreSQL (context)
    â”‚
    â””â”€â–º Calls Agent-Bruno (LLM service)
        â”‚
        â””â”€â–º Returns AI response
            â”‚
            â””â”€â–º Frontend displays message
```

---

## ğŸ¯ Key Concepts

### Vite
- **Dev**: Fast dev server with HMR (Hot Module Replacement)
- **Build**: Bundles React app into static files
- **Proxy**: Forwards `/api/*` to backend in dev mode

### nginx (Production)
- Serves static files from Vite build
- Proxies `/api/*` to API service
- Handles SPA routing (all routes â†’ index.html)

### Telepresence
- Creates VPN tunnel to K8s cluster
- Intercepts service traffic â†’ routes to local container
- Allows testing with real K8s services (DB, Redis) while running code locally

### API Communication
- Frontend always uses `/api/*` (relative URL)
- Works in both dev (Vite proxy) and prod (nginx proxy)
- No code changes needed between environments

---

## ğŸ“ Quick Commands

```bash
# Local development
make dev                    # Run locally (no K8s)

# Telepresence
make tp-port-forward        # Setup
make tp-api                 # Intercept API
make tp-frontend           # Intercept Frontend
make tp-clean              # Cleanup

# Build & Deploy
make build-images-local     # Build images
make deploy-frontend        # Deploy frontend
make deploy-api           # Deploy API
make deploy                # Full deploy
```

---

**TL;DR**: 
- **Vite** = Dev server (HMR) + Build tool (bundles React)
- **nginx** = Serves static files + proxies API in production
- **Telepresence** = Routes K8s traffic to local containers for dev
- **Flow** = User â†’ Frontend â†’ API â†’ PostgreSQL/Redis
