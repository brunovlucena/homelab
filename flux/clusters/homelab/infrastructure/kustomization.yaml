apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# This kustomization deploys all infrastructure components EXCEPT:
# - repositories (deployed in phase1-core)
# - prometheus-operator (deployed in phase2-prometheus)
# - knative-operator (deployed in phase3-knative)
# Those are deployed separately to ensure CRDs are available before dependent components

resources:
  # Core infrastructure (CRDs from prometheus-operator are now available)
  - ../cert-manager
  - ../metrics-server
  - ../minio
  - ../loki
  - ../alloy
  - ../tempo
  # Application infrastructure (Knative CRDs are now available)
  - ../knative-serving
  - ../knative-eventing
  - ../postgres
  - ../redis
  - ../mongodb
  # Agent-specific components (can now use Prometheus CRDs)
  - ../cloudflare-tunnel
  - ../agent-bruno
  - ../homepage
  # Dashboards and monitoring (can now use Prometheus CRDs)
  - ../headlamp