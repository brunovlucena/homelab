apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - namespace.yaml
  - helmrelease.yaml
  - clusterissuer.yaml

# Ensure ClusterIssuer is created after HelmRelease is ready
patches:
  - target:
      kind: ClusterIssuer
      name: linkerd-trust-anchor
    patch: |-
      - op: add
        path: /metadata/annotations
        value:
          fluxcd.io/depends-on: "HelmRelease/cert-manager"