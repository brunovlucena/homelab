---
# LambdaFunction: Flux Reconcile Kustomization (MinIO)
# Remediation function for FluxReconciliationFailure alert
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: flux-reconcile-kustomization
  namespace: ai
  labels:
    app.kubernetes.io/name: flux-reconcile-kustomization
    app.kubernetes.io/component: remediation
    app.kubernetes.io/part-of: agent-sre
    remediation.agent-sre.io/alert: FluxReconciliationFailure
    remediation.agent-sre.io/kind: Kustomization
    source.type: minio
spec:
  source:
    type: minio
    minio:
      endpoint: minio.minio.svc.cluster.local:9000
      bucket: lambda-functions
      key: agent-sre/flux-reconcile-kustomization/main.py
      secretRef:
        name: minio-credentials
  runtime:
    language: python
    version: "3.11"
    handler: handler
  scaling:
    minReplicas: 0
    maxReplicas: 10
    targetConcurrency: 5
    scaleToZeroGracePeriod: 30s
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "500m"
      memory: "256Mi"
  env:
    - name: FLUX_NAMESPACE
      value: "flux-system"
  build:
    timeout: "10m"
    registry: localhost:5001
    insecure: true
  eventing:
    enabled: false  # Called directly by agent-sre

