# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐ AI Agents - Web Command Centers Build Orchestrator
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
#
# Usage:
#   make -f Makefile.web help              # Show available commands
#   make -f Makefile.web docker-build-all  # Build all web command centers
#   make -f Makefile.web docker-build-local-all  # Build all for local registry
#
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Web Command Centers
WEB_DIRS := \
	agent-restaurant/web \
	agent-pos-edge/web-gas-station \
	agent-pos-edge/web-mcdonalds \
	agent-chat/web-command-center \
	agent-store-multibrands/web-command-center

# Configuration
REGISTRY ?= ghcr.io/brunovlucena
LOCAL_REGISTRY ?= localhost:5001

.PHONY: help docker-build-all docker-push-all docker-build-local-all dev-install-all build-all clean-all status

help: ## Show this help
	@echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
	@echo "๐ AI Agents - Web Command Centers Build Orchestrator"
	@echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
	@echo ""
	@echo "Web Command Centers:"
	@for dir in $(WEB_DIRS); do echo "  โข $$dir"; done
	@echo ""
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-25s\033[0m %s\n", $$1, $$2}'

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# Docker Build Commands
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

docker-build-all: ## Build all web command center Docker images
	@echo "๐ Building all web command centers..."
	@for dir in $(WEB_DIRS); do \
		echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"; \
		echo "๐ฆ Building $$dir..."; \
		$(MAKE) -C $$dir docker-build REGISTRY=$(REGISTRY) || exit 1; \
	done
	@echo ""
	@echo "โ All web command centers built successfully!"

docker-push-all: ## Build and push all Docker images to registry
	@echo "๐ Building and pushing all web command centers..."
	@for dir in $(WEB_DIRS); do \
		echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"; \
		echo "๐ค Building and pushing $$dir..."; \
		$(MAKE) -C $$dir docker-push REGISTRY=$(REGISTRY) || exit 1; \
	done
	@echo ""
	@echo "โ All web command centers pushed to $(REGISTRY)!"

docker-build-local-all: ## Build and push all to local registry
	@echo "๐ Building all web command centers for local registry..."
	@for dir in $(WEB_DIRS); do \
		echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"; \
		echo "๐ฆ Building $$dir for local registry..."; \
		$(MAKE) -C $$dir docker-build-local LOCAL_REGISTRY=$(LOCAL_REGISTRY) || exit 1; \
	done
	@echo ""
	@echo "โ All web command centers pushed to $(LOCAL_REGISTRY)!"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# Individual Builds
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

docker-build-restaurant: ## Build restaurant command center
	$(MAKE) -C agent-restaurant/web docker-build REGISTRY=$(REGISTRY)

docker-build-gas-station: ## Build gas station command center
	$(MAKE) -C agent-pos-edge/web-gas-station docker-build REGISTRY=$(REGISTRY)

docker-build-mcdonalds: ## Build McDonald's command center
	$(MAKE) -C agent-pos-edge/web-mcdonalds docker-build REGISTRY=$(REGISTRY)

docker-build-chat: ## Build AgentChat command center
	$(MAKE) -C agent-chat/web-command-center docker-build REGISTRY=$(REGISTRY)

docker-build-store: ## Build Multi-Brand Store command center
	$(MAKE) -C agent-store-multibrands/web-command-center docker-build REGISTRY=$(REGISTRY)

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# Development
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

dev-install-all: ## Install npm dependencies for all web apps
	@echo "๐ฆ Installing dependencies for all web command centers..."
	@for dir in $(WEB_DIRS); do \
		echo "Installing dependencies in $$dir..."; \
		$(MAKE) -C $$dir install || exit 1; \
	done
	@echo "โ All dependencies installed!"

build-all: ## Build all web apps (npm build)
	@echo "๐จ Building all web command centers..."
	@for dir in $(WEB_DIRS); do \
		echo "Building $$dir..."; \
		$(MAKE) -C $$dir build || exit 1; \
	done
	@echo "โ All web apps built!"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# Utilities
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

clean-all: ## Clean all build artifacts
	@echo "๐งน Cleaning all web command centers..."
	@for dir in $(WEB_DIRS); do \
		echo "Cleaning $$dir..."; \
		$(MAKE) -C $$dir clean || true; \
	done
	@echo "โ All cleaned!"

status: ## Show build status summary
	@echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
	@echo "๐ Web Command Centers Status"
	@echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
	@echo ""
	@echo "๐ Directories:"
	@for dir in $(WEB_DIRS); do \
		if [ -f "$$dir/Dockerfile" ] && [ -f "$$dir/Makefile" ]; then \
			echo "  โ $$dir (Dockerfile + Makefile)"; \
		elif [ -f "$$dir/Dockerfile" ]; then \
			echo "  โ๏ธ  $$dir (Dockerfile only)"; \
		elif [ -f "$$dir/Makefile" ]; then \
			echo "  โ๏ธ  $$dir (Makefile only)"; \
		else \
			echo "  โ $$dir (missing)"; \
		fi \
	done
	@echo ""
	@echo "๐ Registries:"
	@echo "  โข GHCR: $(REGISTRY)"
	@echo "  โข Local: $(LOCAL_REGISTRY)"
	@echo ""
	@echo "๐ง Standard Commands (available in each web app):"
	@echo "  โข make dev               - Run local development server"
	@echo "  โข make install           - Install npm dependencies"
	@echo "  โข make build             - Build for production"
	@echo "  โข make docker-build      - Build Docker image"
	@echo "  โข make docker-push       - Push to registry"
	@echo "  โข make docker-build-local - Build & push to local registry"
	@echo "  โข make docker-run        - Run container locally"
	@echo "  โข make clean             - Clean build artifacts"
