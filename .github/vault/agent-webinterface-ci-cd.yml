# ============================================================================
# ğŸŒ Agent-Webinterface - CI/CD
# ============================================================================
# Next.js web interface for AI agents.
# ============================================================================

name: ğŸŒ Agent-Webinterface - CI/CD

permissions:
  contents: read
  packages: write
  security-events: write

on:
  push:
    branches: [main, feature/*, bugfix/*]
    paths:
      - 'flux/ai/agent-webinterface/**'
      - '.github/workflows/agent-webinterface-ci-cd.yml'
  pull_request:
    branches: [main]
    paths:
      - 'flux/ai/agent-webinterface/**'
  workflow_dispatch:

env:
  WORKING_DIR: flux/ai/agent-webinterface

jobs:
  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  # Detect Changes
  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  detect:
    name: ğŸ” Detect Changes
    uses: ./.github/workflows/_reusable-detect-changes.yml
    with:
      working-directory: flux/ai/agent-webinterface

  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  # Lint & Build
  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  lint:
    name: ğŸ” Lint & Build
    uses: ./.github/workflows/_reusable-nodejs-ci.yml
    with:
      working-directory: flux/ai/agent-webinterface
      node-version: '20'
      run-tests: false

  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  # Docker Build & Push
  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  build:
    name: ğŸ—ï¸ Build & Push
    needs: [detect, lint]
    if: |
      needs.detect.outputs.should_deploy == 'true' &&
      (needs.lint.result == 'success' || needs.lint.result == 'skipped')
    uses: ./.github/workflows/_reusable-docker-build.yml
    with:
      image-name: agent-webinterface
      dockerfile: Dockerfile
      context: flux/ai/agent-webinterface
      version: ${{ needs.detect.outputs.docker_tag }}
      push: ${{ github.event_name != 'pull_request' }}
    secrets: inherit

  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  # Security Scan
  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  security:
    name: ğŸ”’ Security
    uses: ./.github/workflows/_reusable-security-scan.yml
    with:
      scan-path: flux/ai/agent-webinterface
      scan-type: fs
    secrets: inherit
